/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
var error ="";
var query1="";
var Data_Tramites;
$(document).ready(function() {
    var UsrExt=parseInt(sessionStorage.getItem('Usr_Ext'));
    if(UsrExt==0){
         var User=sessionStorage.getItem('Descrpcion');
         var Name=sessionStorage.getItem('Name');
         Reporte(Name);
          document.getElementById('lbl_user').innerHTML = User;
          $("#opt_configuracion").css('visibility', 'visible');
          $("#opt_rectra").css('visibility', 'visible');
          $("#opt_soltra").css('visibility', 'hidden');
          $("#MenReporte").css('visibility', 'visible');
          var validapro=parseInt(sessionStorage.getItem('PER_VALIDA'));
                if (validapro==1) {
                     $("#optval_profe").css('visibility', 'visible');
                }
    }
    else{
            if(UsrExt==1){
                 var Name=sessionStorage.getItem('NOM_PROFE');
                  document.getElementById('lbl_user').innerHTML = Name;
                   $("#opt_configuracion").css('visibility', 'hidden');
                   $("#opt_rectra").css('visibility', 'hidden');
                   $("#opt_soltra").css('visibility', 'visible');
                   $("#MenReporte").css('visibility', 'hidden');
            }
            else{
                    if(isNaN(UsrExt)){
                         window.location.href = "http://172.23.5.5/Virtual/error.php";
                        $("#opt_configuracion").css('visibility', 'hidden');
                        $("#opt_rectra").css('visibility', 'hidden');
                        $("#opt_soltra").css('visibility', 'hidden');
                        $("#opt_dash").css('visibility', 'hidden');
                        $("#MenReporte").css('visibility', 'hidden');
                    }
            }
           
    }
    tbl_bandasu = $('#Tbl_repo').DataTable({
                                                        data:Data_Tramites,
                                                        language: {
                                                            "decimal": "",
                                                            "emptyTable": "No hay información",
                                                            "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                                                            "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                                                            "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                                                            "infoPostFix": "",
                                                            "thousands": ",",
                                                            "lengthMenu": "Mostrar _MENU_ Entradas",
                                                            "loadingRecords": "Cargando...",
                                                            "processing": "Procesando...",
                                                            "search": "Buscar:",
                                                            "zeroRecords": "Sin resultados encontrados",
                                                            "paginate": {
                                                                "first": "Primero",
                                                                "last": "Ultimo",
                                                                "next": "Siguiente",
                                                                "previous": "Anterior"
                                                            }
                                                        }


                                                    });
    $("#Btn_Generar").click(function(){
               if(tbl_bandasu.rows().count()>0){
                   window.location.href = "http://172.23.5.5/Virtual/logica/ExelSimulacion.php?id="+Name;
               }
               else{
                    bootbox.dialog({
                                                                title: '<a href="#" class="btn btn-warning btn-circle"> <i class="fas fa-radiation-alt"></i></a>',
                                                                message: "No hay Datos que Exportar ",
                                                                onEscape: function() {
                                                               
                                                                }
                                                            });
               }
            
        
    });
});
function Reporte(id){
   
   var ex=0; 
     try {
                              var idcons=id;
                              var parametros={
                                "id":idcons
                                }
                              $.ajax({
					type: "POST",
					dataType: "json",
					async: false,
					cache: false,
					url: "http://172.23.5.5/Virtual/logica/TraerReporte.php",
                                        data: parametros,
					success: function(response){                                           
						 if(JSON.parse(response.ind)){
                                                               ex=response.ind; 
                                                              Data_Tramites=response.row;
                                                                 

                                                } else {
                                                                ex=response.ind;
                                                                error=response.message;
                                                                query1=response.query1;
                                                }
					},
                                        error: function(xhr, textStatus, errorMessage) {
                                                                alert("¡Error (ajax)!"+ errorMessage + textStatus + xhr);
                                        }
				});
                                
                              

    } catch (e) {
        alert("error"+e);
    }
     
                   
}
